<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XRP Nieuws Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
  header { background: #222; color: white; padding: 10px; text-align: center; }
  #percent-bar { display: flex; height: 30px; font-size: 14px; font-weight: bold; color: white; }
  .buy-bar { background: green; text-align: center; }
  .sell-bar { background: red; text-align: center; }
  #news-list { padding: 20px; }
  .news-item { background: white; margin-bottom: 15px; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .news-title a { font-size: 18px; font-weight: bold; color: #0077cc; text-decoration: none; }
  .news-title a:hover { text-decoration: underline; }
  .news-meta { font-size: 12px; color: #666; margin-top: 5px; }
</style>
</head>
<body>

<header>
  <h1>üìä XRP Nieuws Dashboard</h1>
  <div id="percent-bar"></div>
</header>

<div id="news-list">Nieuws wordt geladen...</div>

<script>
async function getXrpBuyerSellerPercentage() {
  try {
    const res = await fetch("https://api.binance.com/api/v3/depth?symbol=XRPUSDT&limit=100");
    const data = await res.json();

    const totalBids = data.bids.reduce((sum, bid) => sum + parseFloat(bid[1]), 0);
    const totalAsks = data.asks.reduce((sum, ask) => sum + parseFloat(ask[1]), 0);
    const total = totalBids + totalAsks;

    return {
      buyers: ((totalBids / total) * 100).toFixed(1),
      sellers: ((totalAsks / total) * 100).toFixed(1)
    };
  } catch (err) {
    console.error("Fout bij ophalen marktdata:", err);
    return { buyers: 50, sellers: 50 }; // fallback
  }
}

async function loadNews() {
  const newsContainer = document.getElementById('news-list');
  const barContainer = document.getElementById('percent-bar');
  newsContainer.innerHTML = 'Nieuws wordt geladen...';
  barContainer.innerHTML = '';

  try {
    // 1Ô∏è‚É£ Koop/verkoop percentages ophalen
    const stats = await getXrpBuyerSellerPercentage();
    const buyerWidth = stats.buyers;
    const sellerWidth = stats.sellers;

    barContainer.innerHTML = `
      <div class="buy-bar" style="width:${buyerWidth}%;">${stats.buyers}% kopen</div>
      <div class="sell-bar" style="width:${sellerWidth}%;">${stats.sellers}% verkopen</div>
    `;

    // 2Ô∏è‚É£ Nieuws ophalen
    const apiKey = "38347feea47a4f0ea7f65acad44fd0f8";
    const url = `https://newsapi.org/v2/everything?q=XRP&language=en&sortBy=publishedAt&pageSize=10&apiKey=${apiKey}`;
    const res = await fetch(url);
    const data = await res.json();

    if (!data.articles || data.articles.length === 0) {
      newsContainer.innerHTML = 'Geen nieuws gevonden.';
      return;
    }

    // 3Ô∏è‚É£ HTML genereren
    let html = '';
    data.articles.forEach(article => {
      const date = new Date(article.publishedAt).toLocaleString("nl-NL");
      html += `<div class="news-item">
        <div class="news-title">
          <a href="${article.url}" target="_blank">${article.title}</a>
        </div>
        <div class="news-meta">Bron: ${article.source.name} ‚Ä¢ ${date}</div>
      </div>`;
    });

    newsContainer.innerHTML = html;

  } catch (err) {
    newsContainer.innerHTML = 'Kon het nieuws niet laden.';
    console.error(err);
  }
}

// Eerste keer laden
loadNews();

// Elke 5 minuten verversen
setInterval(loadNews, 300000);
</script>

</body>
</html>
